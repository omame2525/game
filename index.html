<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ãƒãƒ ã¡ã‚ƒã‚“ãƒ€ãƒƒã‚·ãƒ¥11</title>

<style>
body{
  margin:0;
  background:#ffd6e7;
  text-align:center;
  font-family:sans-serif;
  overflow:hidden;
}
.track{
  position:relative;
  width:95vw;
  height:110px;
  background:white;
  margin:10px auto;
  border-radius:15px;
}
canvas{
  position:absolute;
  top:30px;
  image-rendering:pixelated;
}
button,input{
  font-size:16px;
  padding:6px;
  margin:4px;
  border-radius:8px;
  border:none;
}
button{
  background:#ff9ecf;
  color:white;
}
#result{
  font-size:20px;
  font-weight:bold;
  margin-top:10px;
}
</style>
</head>
<body>

<h2>ğŸ¹ ãƒãƒ ã¡ã‚ƒã‚“ãƒ€ãƒƒã‚·ãƒ¥11</h2>

<input id="playerName" placeholder="è‡ªåˆ†ã®ãƒãƒ ã‚¹ã‚¿ãƒ¼å">
<button onclick="startRace()">ãƒ¬ãƒ¼ã‚¹é–‹å§‹</button>
<button onclick="boost()">ğŸ’¨ ãƒ–ãƒ¼ã‚¹ãƒˆï¼</button>

<div id="tracks"></div>
<div id="result"></div>

<script>
const SIZE=11;
const SCALE=6;

// ===== 11Ã—11 2ã‚³ãƒ =====

// è¶³é–‹ã
const frameA=[
[0,0,0,1,1,1,1,1,0,0,0],
[0,0,1,2,2,2,2,2,1,0,0],
[0,1,2,2,2,2,2,2,2,1,0],
[1,2,2,3,2,2,2,3,2,2,1],
[1,2,2,2,2,2,2,2,2,2,1],
[0,1,2,2,2,2,2,2,2,1,0],
[0,0,1,2,2,2,2,2,1,0,0],
[0,0,0,1,2,2,2,1,0,0,0],
[0,0,0,0,1,1,1,0,0,0,0],
[0,0,0,4,0,0,0,4,0,0,0],
[0,0,4,0,0,0,0,0,4,0,0]
];

// è¶³é–‰ã˜
const frameB=JSON.parse(JSON.stringify(frameA));
frameB[9]=[0,0,0,0,4,0,4,0,0,0,0];
frameB[10]=[0,0,0,0,0,0,0,0,0,0,0];

// ===== åå‰ =====
const cpuNames=[
"ã‚‚ãµã‚Šã‚“","ãã‚‹ã¿","ã½ã¦ã¡","ã—ã‚‰ãŸã¾",
"ããªã“","ã‚ãšã","ã¾ã‚ã‚“","ã ã„ãµã",
"ã“ã‚€ã","ã¡ã‚‡ã“","ã´ã®","ã¿ã‚‹ã"
];

// ===== æ€§æ ¼ =====
const personalities=[
{name:"ã‚¹ãƒ”ãƒ¼ãƒ‰å‹",speed:2.8,stumble:0.04},
{name:"å®‰å®šå‹",speed:2.2,stumble:0.01},
{name:"ãŠã£ã¡ã‚‡ã“ã¡ã‚‡ã„",speed:3.2,stumble:0.07},
{name:"ã®ã‚“ã³ã‚Š",speed:1.8,stumble:0.005}
];

function random(arr){
  return arr[Math.floor(Math.random()*arr.length)];
}

function createCanvas(){
  const c=document.createElement("canvas");
  c.width=SIZE;
  c.height=SIZE;
  c.style.width=(SIZE*SCALE)+"px";
  c.style.height=(SIZE*SCALE)+"px";
  return c;
}

function draw(ctx,data,color,stumble){
  ctx.clearRect(0,0,SIZE,SIZE);

  if(stumble){
    ctx.save();
    ctx.translate(SIZE/2,SIZE/2);
    ctx.rotate(Math.PI/2);
    ctx.translate(-SIZE/2,-SIZE/2);
  }

  for(let y=0;y<SIZE;y++){
    for(let x=0;x<SIZE;x++){
      if(data[y][x]===0) continue;
      ctx.fillStyle=
        data[y][x]===1?color:
        data[y][x]===2?"#fff4dc":
        data[y][x]===3?"#ffb6c1":"#000";
      ctx.fillRect(x,y,1,1);
    }
  }

  if(stumble) ctx.restore();
}

let racers=[];
let raceInterval;
let animInterval;
let boostPower=0;

function startRace(){
  clearInterval(raceInterval);
  clearInterval(animInterval);
  document.getElementById("tracks").innerHTML="";
  document.getElementById("result").innerText="";
  racers=[];
  boostPower=0;

  const playerName=
    document.getElementById("playerName").value || "ã‚ãªãŸã®ãƒãƒ ";

  for(let i=0;i<4;i++){
    const track=document.createElement("div");
    track.className="track";

    const canvas=createCanvas();
    const ctx=canvas.getContext("2d");

    const personality=random(personalities);
    const name=i===0?playerName:random(cpuNames);

    track.innerHTML="<div>"+name+" ("+personality.name+")</div>";
    track.appendChild(canvas);
    document.getElementById("tracks").appendChild(track);

    racers.push({
      name,
      personality,
      canvas,
      ctx,
      pos:0,
      frame:0,
      stumble:false,
      stumbleTimer:0,
      finished:false,
      isPlayer:i===0,
      color:"#d8a45c"
    });
  }

  raceInterval=setInterval(updateRace,80);
  animInterval=setInterval(updateAnim,150);
}

function updateRace(){
  racers.forEach(r=>{
    if(r.finished) return;

    if(Math.random()<r.personality.stumble){
      r.stumble=true;
      r.stumbleTimer=8;
    }

    if(r.stumble){
      r.stumbleTimer--;
      if(r.stumbleTimer<=0) r.stumble=false;
      return;
    }

    let accel=r.personality.speed+(r.isPlayer?boostPower:0);
    r.pos+=accel;
    r.canvas.style.left=r.pos+"px";

    if(r.pos>window.innerWidth*0.75){
      r.finished=true;
      document.getElementById("result").innerText=
        "ğŸ† å„ªå‹ã¯ "+r.name+"ï¼";
    }
  });

  boostPower*=0.9;
}

function updateAnim(){
  racers.forEach(r=>{
    if(r.finished) return;
    r.frame=r.frame===0?1:0;
    draw(r.ctx,r.frame===0?frameA:frameB,r.color,r.stumble);
  });
}

function boost(){
  boostPower+=2;
}
</script>

</body>
</html>