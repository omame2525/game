<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ãƒãƒ ã¡ã‚ƒã‚“ã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆ</title>

<style>
body{
  margin:0;
  background:#ffd6e7;
  text-align:center;
  font-family:sans-serif;
  overflow:hidden;
}
.track{
  position:relative;
  width:95vw;
  height:130px;
  background:white;
  margin:12px auto;
  border-radius:15px;
}
canvas{
  position:absolute;
  top:30px;
  image-rendering:pixelated;
}
button{
  font-size:18px;
  padding:8px 14px;
  border:none;
  border-radius:10px;
  background:#ff9ecf;
  color:white;
  margin:5px;
}
</style>
</head>
<body>

<h2>ğŸ¹ ãƒãƒ ã¡ã‚ƒã‚“ã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆ</h2>
<button onclick="startRace()">ãƒ¬ãƒ¼ã‚¹é–‹å§‹</button>
<button onclick="boost()">ğŸ’¨ ãƒ–ãƒ¼ã‚¹ãƒˆï¼</button>

<div id="tracks"></div>

<script>
const SIZE=16;
const SCALE=4;

// ===== 2ã‚³ãƒãƒ‰ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ =====

// ãƒ•ãƒ¬ãƒ¼ãƒ Aï¼ˆè¶³é–‹ãï¼‰
const frameA=[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0],
[0,0,0,1,1,2,2,2,2,2,1,1,0,0,0,0],
[0,0,1,2,2,2,2,2,2,2,2,2,1,0,0,0],
[0,1,2,2,2,2,2,2,2,2,2,2,2,1,0,0],
[0,1,2,2,2,3,2,2,2,3,2,2,2,1,0,0],
[0,1,2,2,2,2,2,2,2,2,2,2,2,1,0,0],
[0,0,1,2,2,2,2,2,2,2,2,2,1,0,0,0],
[0,0,0,1,2,2,2,2,2,2,2,1,0,0,0,0],
[0,0,0,0,1,2,2,2,2,2,1,0,0,0,0,0],
[0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0],
[0,0,0,0,0,4,0,0,0,4,0,0,0,0,0,0],
[0,0,0,0,4,0,0,0,0,0,4,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
];

// ãƒ•ãƒ¬ãƒ¼ãƒ Bï¼ˆè¶³é–‰ã˜ï¼‰
const frameB=JSON.parse(JSON.stringify(frameA));
frameB[12]=[0,0,0,0,0,0,4,0,0,4,0,0,0,0,0,0];

// ===== ã‚«ãƒ©ãƒ¼ =====
function randomColor(){
  const colors=[
    "#d8a45c","#cfa76e","#a67c52","#e0b07a",
    "#ffcc66","#ff99aa","#aaddff","#ccffcc",
    "#ffddaa","#d0a0ff","#ffaaaa","#aaaaff"
  ];
  return colors[Math.floor(Math.random()*colors.length)];
}

// ===== ã‚­ãƒ£ãƒ³ãƒã‚¹ç”Ÿæˆ =====
function createCanvas(){
  const c=document.createElement("canvas");
  c.width=SIZE;
  c.height=SIZE;
  c.style.width=(SIZE*SCALE)+"px";
  c.style.height=(SIZE*SCALE)+"px";
  return c;
}

// ===== æç”» =====
function draw(ctx,data,bodyColor,isRare,stumble){
  ctx.clearRect(0,0,SIZE,SIZE);

  if(stumble){
    ctx.save();
    ctx.translate(8,8);
    ctx.rotate(Math.PI/2);
    ctx.translate(-8,-8);
  }

  for(let y=0;y<SIZE;y++){
    for(let x=0;x<SIZE;x++){
      let p=data[y][x];
      if(p===0) continue;
      let color;
      if(p===1) color=bodyColor;
      if(p===2) color="#fff4dc";
      if(p===3) color="#ffb6c1";
      if(p===4) color="#000";
      ctx.fillStyle=color;
      ctx.fillRect(x,y,1,1);
    }
  }

  if(isRare){
    ctx.fillStyle="yellow";
    ctx.fillRect(Math.random()*16,Math.random()*16,1,1);
  }

  if(stumble) ctx.restore();
}

// ===== ãƒ¬ãƒ¼ã‚¹ =====
let racers=[];
let raceInterval;
let animInterval;
let boostPower=0;

function startRace(){
  clearInterval(raceInterval);
  clearInterval(animInterval);
  document.getElementById("tracks").innerHTML="";
  racers=[];
  boostPower=0;

  for(let i=0;i<4;i++){
    const track=document.createElement("div");
    track.className="track";

    const canvas=createCanvas();
    const ctx=canvas.getContext("2d");

    const isRare=Math.random()<0.1;
    const bodyColor=isRare?"gold":randomColor();

    track.appendChild(canvas);
    document.getElementById("tracks").appendChild(track);

    racers.push({
      canvas,
      ctx,
      pos:0,
      speed:1+Math.random()*2,
      frame:0,
      stumble:false,
      stumbleTimer:0,
      finished:false,
      bodyColor,
      isRare,
      isPlayer:i===0
    });
  }

  raceInterval=setInterval(updateRace,80);
  animInterval=setInterval(updateAnim,150);
}

function updateRace(){
  racers.forEach(r=>{
    if(r.finished) return;

    if(Math.random()<0.02){
      r.stumble=true;
      r.stumbleTimer=10;
    }

    if(r.stumble){
      r.stumbleTimer--;
      if(r.stumbleTimer<=0) r.stumble=false;
      return;
    }

    let accel=r.speed + (r.isPlayer?boostPower:0);
    r.pos+=accel;
    r.canvas.style.left=r.pos+"px";

    if(r.pos>window.innerWidth*0.75){
      r.finished=true;
      r.canvas.style.top="10px";
    }
  });

  boostPower*=0.9;
}

function updateAnim(){
  racers.forEach(r=>{
    if(r.finished) return;
    r.frame=r.frame===0?1:0;
    draw(r.ctx,r.frame===0?frameA:frameB,r.bodyColor,r.isRare,r.stumble);
  });
}

function boost(){
  boostPower+=2;
}
</script>

</body>
</html>