<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒãƒ ã¡ã‚ƒã‚“ãƒ€ãƒƒã‚·ãƒ¥DX</title>

<style>
body {
  margin: 0;
  font-family: sans-serif;
  background: linear-gradient(#ffeef5, #ffd6e7);
  text-align: center;
}

h1 { font-size: 6vw; margin: 10px; }

input, button {
  font-size: 4vw;
  padding: 6px;
  border-radius: 12px;
  border: none;
  margin: 5px;
}

button { background: #ff9ecf; color: white; }

.track {
  position: relative;
  width: 95vw;
  height: 16vh;
  background: white;
  margin: 8px auto;
  border-radius: 15px;
  overflow: hidden;
}

.hamster {
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  font-size: 8vw;
  transition: transform 0.2s;
}

.jump {
  animation: jump 0.4s ease;
}

@keyframes jump {
  0%{transform:translateY(-50%)}
  50%{transform:translateY(-80%)}
  100%{transform:translateY(-50%)}
}

.nameTag {
  position: absolute;
  top: 4px;
  left: 5px;
  font-size: 3vw;
}

.goal {
  position: absolute;
  right: 5px;
  top: 5px;
  font-size: 4vw;
}
</style>
</head>
<body>

<h1>ğŸ¹ ãƒãƒ ã¡ã‚ƒã‚“ãƒ€ãƒƒã‚·ãƒ¥DX ğŸ’¨</h1>

<div>
  åå‰ï¼š
  <input id="playerName" value="ã‚‚ã¡ã¾ã‚‹">
  <button onclick="startRace()">ãƒ¬ãƒ¼ã‚¹é–‹å§‹</button>
</div>

<div>ğŸ’° ã‚³ã‚¤ãƒ³: <span id="coins">0</span>
<button onclick="upgrade()">ã‚¹ãƒ”ãƒ¼ãƒ‰å¼·åŒ– (10)</button>
</div>

<div id="tracks"></div>

<div>
  <button onclick="boost()">ğŸ’— ã‚¿ãƒƒãƒ—å¿œæ´ï¼</button>
</div>

<h2 id="result"></h2>

<script>
const cpuNames=["ã‚‚ãµã‚Šã‚“","ãã‚‹ã¿","ã½ã¦ã¡","ã¡ã‚‡ã“","ã„ã¡ã”","ã·ã‚Šã‚“","ã¿ã‚‹ã","ã¾ã‚ã‚“","ããªã“","ã‚ã‚“ãš","ãµã‚ã‚Š","ã“ã‚ã‚“","ã‚‚ã“ãŸã‚“","ã½ã½","ã‚‹ã‚‹","ã´ã®","ã¡ã‚ƒã‚€","ã“ã‚ã¾ã‚‹","ã—ã‚…ãŒãƒ¼","ã´ã‚‡ã“"];

const personalities=[
{name:"ã®ã‚“ã³ã‚Š",speed:1.5,stumble:0.05},
{name:"ã‚ã‚ã¦ã‚“ã¼ã†",speed:2.5,stumble:0.15},
{name:"ãã¾ãã‚Œ",speed:2.0,stumble:0.10},
{name:"ã¦ã‚“ã•ã„",speed:3.0,stumble:0.03}
];

let racers=[];
let raceInterval;
let raceFinished=false;
let coins=parseInt(localStorage.getItem("coins"))||0;
let playerBoost=8;

document.getElementById("coins").textContent=coins;

function randomItem(a){return a[Math.floor(Math.random()*a.length)];}

function startRace(){
  raceFinished=false;
  clearInterval(raceInterval);
  document.getElementById("tracks").innerHTML="";
  document.getElementById("result").textContent="";
  racers=[];

  let playerName=document.getElementById("playerName").value||"ã‚ãªãŸ";
  let used=[playerName];

  for(let i=0;i<3;i++){
    let name=i===0?playerName:randomItem(cpuNames.filter(n=>!used.includes(n)));
    used.push(name);
    let p=randomItem(personalities);

    let track=document.createElement("div");
    track.className="track";

    let tag=document.createElement("div");
    tag.className="nameTag";
    tag.textContent=name+"ï¼ˆ"+p.name+"ï¼‰";

    let ham=document.createElement("div");
    ham.className="hamster";
    ham.textContent="ğŸ¹";

    let goal=document.createElement("div");
    goal.className="goal";
    goal.textContent="ğŸ";

    track.appendChild(tag);
    track.appendChild(goal);
    track.appendChild(ham);
    document.getElementById("tracks").appendChild(track);

    racers.push({name:name,personality:p,element:ham,pos:0,isPlayer:i===0});
  }

  raceInterval=setInterval(updateRace,100);
}

function updateRace(){
  racers.forEach(r=>{
    if(raceFinished) return;

    if(!r.isPlayer){
      if(Math.random()<r.personality.stumble){
        showStumble(r.element);
        return;
      }
      r.pos+=r.personality.speed*Math.random();
    }

    r.element.style.left=r.pos+"px";

    if(r.pos>window.innerWidth*0.75){
      finish(r);
    }
  });
}

function boost(){
  if(raceFinished) return;
  let p=racers[0];
  p.pos+=playerBoost;
  p.element.style.left=p.pos+"px";
}

function showStumble(el){
  el.textContent="ğŸ’«";
  setTimeout(()=>{el.textContent="ğŸ¹"},300);
}

function finish(winner){
  raceFinished=true;
  clearInterval(raceInterval);

  if(winner.isPlayer){
    coins+=5;
    localStorage.setItem("coins",coins);
    document.getElementById("coins").textContent=coins;
    document.getElementById("result").textContent="ğŸ‰ å‹åˆ©ï¼+5ã‚³ã‚¤ãƒ³";
    winner.element.classList.add("jump");
  }else{
    document.getElementById("result").textContent="ğŸ’¦ "+winner.name+" ã®å‹ã¡";
  }
}

function upgrade(){
  if(coins>=10){
    coins-=10;
    playerBoost+=2;
    localStorage.setItem("coins",coins);
    document.getElementById("coins").textContent=coins;
    alert("ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ï¼");
  }
}
</script>

</body>
</html>